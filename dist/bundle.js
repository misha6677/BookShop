(()=>{"use strict";class t{static async fetchBooks(t="fiction",e=0){const s=await fetch(`https://www.googleapis.com/books/v1/volumes?q="subject:${t}"&key=AIzaSyDRCf64mTQu6H7r8clObkZ7k4Vt-NCJU6o&printType=books&startIndex=${e}&maxResults=6&langRestrict=en`);if(!s.ok)throw new Error("Failed to fetch books");return await s.json()}}class e{constructor(){this.items=this.loadCart()}loadCart(){const t=localStorage.getItem("bookshopCart");return t?JSON.parse(t):[]}saveCart(){localStorage.setItem("bookshopCart",JSON.stringify(this.items))}addBook(t){this.items.some((e=>e.id===t.id))||(this.items.push(t),this.saveCart(),this.updateCartBadge())}removeBook(t){this.items=this.items.filter((e=>e.id!==t)),this.saveCart(),this.updateCartBadge()}updateCartBadge(){const t=document.querySelector(".cart-badge");t&&(t.textContent=this.items.length,t.style.display=this.items.length?"block":"none")}isInCart(t){return this.items.some((e=>e.id===t))}}class s{static renderBook(t,e){const{volumeInfo:s,saleInfo:o}=t,i=s.authors?s.authors.join(", "):"Unknown author",r=s.imageLinks?.thumbnail||"path/to/placeholder.jpg",n=s.averageRating?this.renderRating(s.averageRating,s.ratingsCount):"",a=o?.retailPrice?`$${o.retailPrice.amount}`:"";return`\n      <div class="book-card" data-id="${t.id}">\n        <img src="${r}" alt="${s.title}" class="book-cover">\n        <div class="book-details">\n          <p class="book-author">${i}</p>\n          <h3 class="book-title">${s.title}</h3>\n          ${n}\n          <p class="book-description">${this.truncateDescription(s.description)}</p>\n          ${a?`<p class="book-price">${a}</p>`:""}\n          <button class="buy-btn ${e?"in-cart":""}">\n            ${e?"In Cart":"Buy Now"}\n          </button>\n        </div>\n      </div>\n    `}static truncateDescription(t){return t?t.length>150?`${t.substring(0,150)}...`:t:""}static renderRating(t,e){return`<div class="book-rating">\n      <span class="stars">${"★".repeat(Math.round(t))+"☆".repeat(5-Math.round(t))}</span>\n      <span class="reviews-count">(${e||0})</span>\n    </div>`}}class o{constructor(t,e={}){this.container=document.querySelector(t),this.slides=this.container.querySelectorAll(".slide"),this.interval=e.interval||5e3,this.currentIndex=0,this.timer=null,this.init()}init(){this.createDots(),this.showSlide(this.currentIndex),this.startAutoPlay(),this.setupEventListeners()}createDots(){const t=this.container.querySelector(".slider-dots");this.slides.forEach(((e,s)=>{const o=document.createElement("div");o.classList.add("dot"),s===this.currentIndex&&o.classList.add("active"),o.addEventListener("click",(()=>this.goToSlide(s))),t.appendChild(o)}))}showSlide(t){this.slides.forEach(((e,s)=>{e.classList.toggle("active",s===t)})),this.container.querySelectorAll(".dot").forEach(((e,s)=>{e.classList.toggle("active",s===t)})),this.currentIndex=t}nextSlide(){const t=(this.currentIndex+1)%this.slides.length;this.showSlide(t)}prevSlide(){const t=(this.currentIndex-1+this.slides.length)%this.slides.length;this.showSlide(t)}goToSlide(t){this.showSlide(t),this.resetAutoPlay()}startAutoPlay(){this.timer=setInterval((()=>this.nextSlide()),this.interval)}resetAutoPlay(){clearInterval(this.timer),this.startAutoPlay()}setupEventListeners(){this.container.addEventListener("mouseenter",(()=>clearInterval(this.timer))),this.container.addEventListener("mouseleave",(()=>this.startAutoPlay()))}}class i{constructor(){this.cart=new e,this.currentCategory="fiction",this.currentIndex=0,this.isLoading=!1,this.hasMoreBooks=!0,this.init()}init(){new o(".slider-container",{interval:5e3}),this.cart.updateCartBadge(),this.setupCategoryButtons(),this.setupLoadMoreButton(),this.setupCartButtons(),this.loadBooks()}async loadBooks(e=!1){if(!this.isLoading&&this.hasMoreBooks){this.isLoading=!0,e&&(this.currentIndex=0,this.hasMoreBooks=!0,document.querySelector(".books-container").innerHTML="",document.querySelector(".load-more").style.display="block");try{const s=await t.fetchBooks(this.currentCategory,this.currentIndex);s.items&&s.items.length>0?(this.displayBooks(s.items),this.currentIndex+=s.items.length,this.hasMoreBooks=6===s.items.length):(this.hasMoreBooks=!1,e&&this.showNoBooksMessage())}catch(t){console.error("Error loading books:",t),this.showErrorLoadingBooks()}finally{this.isLoading=!1,document.querySelector(".load-more").style.display=this.hasMoreBooks?"block":"none"}}}displayBooks(t){const e=document.querySelector(".books-container");t.forEach((t=>{const o=this.cart.isInCart(t.id);e.insertAdjacentHTML("beforeend",s.renderBook(t,o))}))}showNoBooksMessage(){document.querySelector(".books-container").innerHTML='\n      <div class="no-books-message">\n        <i class="fas fa-book-open"></i>\n        <p>No books found in this category</p>\n      </div>\n    '}showErrorLoadingBooks(){document.querySelector(".books-container").innerHTML='\n      <div class="error-message">\n        <i class="fas fa-exclamation-triangle"></i>\n        <p>Failed to load books. Please try again later.</p>\n        <button class="btn btn--primary retry-btn">Retry</button>\n      </div>\n    ',document.querySelector(".retry-btn").addEventListener("click",(()=>this.loadBooks(!0)))}setupCategoryButtons(){document.querySelectorAll(".category-btn").forEach((t=>{t.addEventListener("click",(()=>{t.classList.contains("active")||(document.querySelector(".category-btn.active").classList.remove("active"),t.classList.add("active"),this.currentCategory=t.dataset.category,this.loadBooks(!0))}))}))}setupLoadMoreButton(){document.querySelector(".load-more").addEventListener("click",(()=>this.loadBooks()))}setupCartButtons(){document.addEventListener("click",(t=>{if(t.target.classList.contains("buy-btn")){const e=t.target.closest(".book-card"),s=e.dataset.id;if(this.cart.isInCart(s))this.cart.removeBook(s),t.target.textContent="Buy Now",t.target.classList.remove("in-cart");else{const o={id:s,title:e.querySelector(".book-title").textContent,author:e.querySelector(".book-author").textContent,price:e.querySelector(".book-price")?.textContent||"",image:e.querySelector(".book-cover").src};this.cart.addBook(o),t.target.textContent="In Cart",t.target.classList.add("in-cart")}}}))}}document.addEventListener("DOMContentLoaded",(()=>{new i}))})();